<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accueil et Planning des Réservations (Version de Base)</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 { text-align: center; }
        .reservation-data { margin-top: 20px; border: 1px solid #ccc; padding: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Planning des Réservations (Brut)</h1>
        
        <div id="loading">Chargement des réservations...</div>
        <div id="error-display" style="color: red;"></div>
        
        <div id="reservations-output" class="reservation-data">
            </div>

        <p style="margin-top: 30px; text-align: center;">
            <a id="validation-link" href="/cleaning_form.html" style="padding: 10px 20px; background-color: #ccc; color: black; text-decoration: none; border-radius: 5px;">
                Aller au Formulaire de Validation Ménage
            </a>
        </p>
    </div>

    <script>
        // ----------------------------------------------------
        // ÉTAPE 1 : Configuration Supabase
        // ----------------------------------------------------
        const SUPABASE_URL = 'https://ivqiisnudabxemcxxyru.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml2cWlpc251ZGFieGVtY3h4eXJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzOTk0NjMsImV4cCI6MjA4MDk3NTQ2M30.9FwJPgR8bbaP7bAemuaVbAN019EO5ql7uciQO9FeHK4'; 
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // ----------------------------------------------------
        // ÉTAPE 2 : Récupération des Données (TOUTES)
        // ----------------------------------------------------

        async function fetchAllReservations() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error-display').textContent = '';

            // Requête SELECT qui récupère TOUTES les réservations, passées et futures
            const { data: reservations, error } = await supabase
                .from('reservations')
                .select('id, gite, date_debut, date_fin, nom_client, menage_valide') 
                .order('date_fin', { ascending: false }); // Classe par date la plus récente

            document.getElementById('loading').style.display = 'none';

            if (error) {
                console.error('Erreur Supabase lors du SELECT des réservations :', error);
                document.getElementById('error-display').textContent = `Erreur de connexion : ${error.message}.`;
                return;
            }

            // Affiche les données de manière brute
            document.getElementById('reservations-output').textContent = JSON.stringify(reservations, null, 2);
        }

        document.addEventListener('DOMContentLoaded', fetchAllReservations);

    </script>
</body>
</html>
